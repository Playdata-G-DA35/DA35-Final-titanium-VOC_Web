{% extends 'navi.html' %}

{% block title %}상품 성과분석{% endblock %}

{% block content %}
{% load static %}

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }
    .block {
        border: 1px solid #ddd;
        padding: 20px;
        margin-top: 20px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: center;
    }
    th {
        background-color: #f4f4f4;
        
    }
    .subcategory-group {
        margin-top: 10px;
        margin-bottom: 20px;
    }
    .subcategory-group label {
        margin-right: 10px;
    }
    .slider-container {
        margin: 20px 0;
        padding: 10px;
        border: 1px solid #333;
        border-radius: 8px;
        position: relative;
        background-color: #f9f9f9;
    }
    .slider-labels {
        display: flex;
        justify-content: space-between;
        font-size: 14px;
        padding: 0 10px;
    }
    .slider-track {
        height: 4px;
        background-color: #ddd;
        position: relative;
        margin: 10px 0;
    }
    .slider-fill {
        height: 100%;
        background-color: #007bff;
        position: absolute;
        left: 0;
        transition: width 0.3s ease;
    }
    .slider-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background-color: #007bff;
        position: absolute;
        top: 50%;
        transform: translate(-50%, -50%);
        cursor: pointer;
        transition: left 0.3s ease;
    }
    .slider-thumb.positive {
        background-color: lightgreen;
    }
    .slider-thumb.negative {
        background-color: lightcoral;
    }
    .reviewtag-title {
        font-weight: bold;
        margin-bottom: 10px;
    }
    .purchase-reviews-container {
        display: flex;
        justify-content: space-between;
    }
    .review-tag-buttons {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(4, auto);
        gap: 10px;
        width: 250px;
    }
    .review-tag-button {
        padding: 10px;
        background-color: #f0f0f0;
        border: 1px solid #ddd;
        cursor: pointer;
        text-align: center;
    }
    .review-tag-button.active {
        background-color: #007bff;
        color: white;
    }
    #review-tag-results {
        flex-grow: 1;
        margin-right: 20px;
    }
    /*테이블*/
    /* 테이블 전체 스타일 */
    #product-like-table {
        width: 100%; /* 테이블이 부모 컨테이너의 전체 너비를 차지하도록 설정 */
        border-collapse: collapse; /* 셀 경계가 서로 겹치지 않도록 설정 */
        margin-bottom: 20px; /* 테이블 아래에 여백 추가 */
    }

    /* 테이블 헤더 스타일 */
    #product-like-table th {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); /* 그라데이션 배경색 */
        color: #fff; /* 헤더 텍스트 색상 */
        padding: 12px 15px; /* 헤더 셀의 패딩 */
        text-align: center; /* 헤더 텍스트 왼쪽 정렬 */
        border-bottom: 3px solid #0056b3; /* 헤더 셀 하단에 경계선 추가 */
        font-weight: bold; /* 헤더 텍스트 두껍게 */
    }

    /* 테이블 데이터 셀 스타일 */
    #product-like-table td {
        padding: 10px 15px; /* 데이터 셀의 패딩 */
        border-bottom: 1px solid #dee2e6; /* 데이터 셀 하단에 경계선 추가 */
        text-align: center; /* 데이터 텍스트 중앙 정렬 */
    }

    /* 테이블 행의 배경색 변경 */
    #product-like-table tr:nth-child(even) {
        background-color: #f9f9f9; /* 짝수 행 배경색 */
    }

    #product-like-table tr:hover {
        background-color: #e9ecef; /* 마우스 오버 시 배경색 */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 마우스 오버 시 그림자 효과 */
    }

    /* 상위 5개 상품 리스트 스타일 */
    #top-like-products-list {
        list-style-type: none; /* 기본 리스트 스타일 제거 */
        padding: 0; /* 패딩 제거 */
        margin: 0; /* 마진 제거 */
    }

    #top-like-products-list li {
        background: #fff; /* 리스트 항목 배경색 */
        border: 1px solid #ddd; /* 리스트 항목 경계선 */
        border-radius: 8px; /* 경계선 둥글게 처리 */
        padding: 10px 15px; /* 리스트 항목 패딩 */
        margin-bottom: 10px; /* 리스트 항목 사이에 여백 추가 */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* 리스트 항목에 그림자 효과 추가 */
        transition: transform 0.3s ease, box-shadow 0.3s ease; /* 전환 효과 추가 */
    }

    #top-like-products-list li:hover {
        transform: translateY(-4px); /* 마우스 오버 시 살짝 위로 이동 */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* 마우스 오버 시 그림자 효과 강화 */
    }
    #grade-average-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }

    #grade-average-table th {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        color: #fff;
        padding: 12px 15px;
        text-align: center;
        border-bottom: 3px solid #0056b3;
        font-weight: bold;
    }

    #grade-average-table td {
        padding: 10px 15px;
        border-bottom: 1px solid #dee2e6;
        text-align: center;
    }

    #grade-average-table tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    #grade-average-table tr:hover {
        background-color: #e9ecef;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #top-grade-products-list {
        list-style-type: none;
        padding: 0;
        margin: 0;
    }

    #top-grade-products-list li {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 10px 15px;
        margin-bottom: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    #top-grade-products-list li:hover {
        transform: translateY(-4px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    /* 테이블 기본 스타일 */
    #views-average-table, #age-group-table, #gender-distribution-table {
        width: 100%; /* 테이블이 부모 컨테이너의 전체 너비를 차지하도록 설정 */
        border-collapse: collapse; /* 셀 경계가 서로 겹치지 않도록 설정 */
        margin-bottom: 20px; /* 테이블 아래에 여백 추가 */
    }

    /* 테이블 헤더 스타일 */
    #views-average-table th, #age-group-table th, #gender-distribution-table th {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); /* 그라데이션 배경색 */
        color: #fff; /* 헤더 텍스트 색상 */
        padding: 12px 15px; /* 헤더 셀의 패딩 */
        text-align: center; /* 헤더 텍스트 왼쪽 정렬 */
        border-bottom: 3px solid #0056b3; /* 헤더 셀 하단에 경계선 추가 */
        font-weight: bold; /* 헤더 텍스트 두껍게 */
    }

    /* 테이블 데이터 셀 스타일 */
    #views-average-table td, #age-group-table td, #gender-distribution-table td {
        padding: 10px 15px; /* 데이터 셀의 패딩 */
        border-bottom: 1px solid #dee2e6; /* 데이터 셀 하단에 경계선 추가 */
        text-align: center; /* 데이터 텍스트 중앙 정렬 */
    }

    /* 테이블 행의 배경색 변경 */
    #views-average-table tr:nth-child(even), #age-group-table tr:nth-child(even), #gender-distribution-table tr:nth-child(even) {
        background-color: #f9f9f9; /* 짝수 행 배경색 */
    }

    #views-average-table tr:hover, #age-group-table tr:hover, #gender-distribution-table tr:hover {
        background-color: #e9ecef; /* 마우스 오버 시 배경색 */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 마우스 오버 시 그림자 효과 */
    }

    /* 상위 5개 상품 리스트 스타일 */
    #top-views-products-list {
        list-style-type: none; /* 기본 리스트 스타일 제거 */
        padding: 0; /* 패딩 제거 */
        margin: 0; /* 마진 제거 */
    }

    #top-views-products-list li {
        background: #fff; /* 리스트 항목 배경색 */
        border: 1px solid #ddd; /* 리스트 항목 경계선 */
        border-radius: 8px; /* 경계선 둥글게 처리 */
        padding: 10px 15px; /* 리스트 항목 패딩 */
        margin-bottom: 10px; /* 리스트 항목 사이에 여백 추가 */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* 리스트 항목에 그림자 효과 추가 */
        transition: transform 0.3s ease, box-shadow 0.3s ease; /* 전환 효과 추가 */
    }

    #top-views-products-list li:hover {
        transform: translateY(-4px); /* 마우스 오버 시 살짝 위로 이동 */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* 마우스 오버 시 그림자 효과 강화 */
    }
    /* 테이블 기본 스타일 */
    #purchases-average-table, #age-group-purchases-table, #gender-distribution-purchases-table {
        width: 100%; /* 테이블이 부모 컨테이너의 전체 너비를 차지하도록 설정 */
        border-collapse: collapse; /* 셀 경계가 서로 겹치지 않도록 설정 */
        margin-bottom: 20px; /* 테이블 아래에 여백 추가 */
    }

    /* 테이블 헤더 스타일 */
    #purchases-average-table th, #age-group-purchases-table th, #gender-distribution-purchases-table th {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); /* 그라데이션 배경색 */
        color: #fff; /* 헤더 텍스트 색상 */
        padding: 12px 15px; /* 헤더 셀의 패딩 */
        text-align: center; /* 헤더 텍스트 왼쪽 정렬 */
        border-bottom: 3px solid #0056b3; /* 헤더 셀 하단에 경계선 추가 */
        font-weight: bold; /* 헤더 텍스트 두껍게 */
    }

    /* 테이블 데이터 셀 스타일 */
    #purchases-average-table td, #age-group-purchases-table td, #gender-distribution-purchases-table td {
        padding: 10px 15px; /* 데이터 셀의 패딩 */
        border-bottom: 1px solid #dee2e6; /* 데이터 셀 하단에 경계선 추가 */
        text-align: center; /* 데이터 텍스트 중앙 정렬 */
    }

    /* 테이블 행의 배경색 변경 */
    #purchases-average-table tr:nth-child(even), #age-group-purchases-table tr:nth-child(even), #gender-distribution-purchases-table tr:nth-child(even) {
        background-color: #f9f9f9; /* 짝수 행 배경색 */
    }

    #purchases-average-table tr:hover, #age-group-purchases-table tr:hover, #gender-distribution-purchases-table tr:hover {
        background-color: #e9ecef; /* 마우스 오버 시 배경색 */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 마우스 오버 시 그림자 효과 */
    }

    /* 상위 5개 상품 리스트 스타일 */
    #top-purchases-products-list {
        list-style-type: none; /* 기본 리스트 스타일 제거 */
        padding: 0; /* 패딩 제거 */
        margin: 0; /* 마진 제거 */
    }

    #top-purchases-products-list li {
        background: #fff; /* 리스트 항목 배경색 */
        border: 1px solid #ddd; /* 리스트 항목 경계선 */
        border-radius: 8px; /* 경계선 둥글게 처리 */
        padding: 10px 15px; /* 리스트 항목 패딩 */
        margin-bottom: 10px; /* 리스트 항목 사이에 여백 추가 */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* 리스트 항목에 그림자 효과 추가 */
        transition: transform 0.3s ease, box-shadow 0.3s ease; /* 전환 효과 추가 */
    }

    #top-purchases-products-list li:hover {
        transform: translateY(-4px); /* 마우스 오버 시 살짝 위로 이동 */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* 마우스 오버 시 그림자 효과 강화 */
    }

</style>
</head>
<body>
    <h1 class="font-bold bg-gray-300 p-2 text-left text-2xl box2 mb-4">상품성과분석</h1>
    <section class="card bg-white shadow-md rounded-md p-4 mb-5">   
        <form id="filterForm">
            <label for="category">Category:</label>
            <select id="category" name="category" onchange="updateSubcategories()" required>
                <option value="">카테고리 선택</option>
                <option value="상의">상의</option>
                <option value="바지">바지</option>
                <option value="아우터">아우터</option>
            </select>
            <button type="button" onclick="applyFilters()" class="px-3 py-1.5 bg-blue-500 text-white text-sm font-semibold rounded-md shadow-sm hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400">
                적용
            </button>
    
            <div id="subcategory-container" class="subcategory-group">
                <!-- Subcategory 체크박스가 여기에 동적으로 삽입됩니다 -->
            </div>
        </form>
    </section>
    
    <section class="card bg-white shadow-md rounded-md p-4 mb-5">
        <!-- Product Likes Section -->
        <div class="block" id="product-like-results">
            <h2>상품 좋아요 분석</h2>
            <div id="product-like-table">
                <!-- Product Like 테이블이 여기에 삽입됩니다 -->
            </div>
            <div id="top-like-products">
                <h3>상위5개 상품좋아요</h3>
                <ul id="top-like-products-list">
                    <!-- 상위 5개 상품명이 여기에 삽입됩니다 -->
                </ul>
            </div>
        </div>
    </section>
    <section class="card bg-white shadow-md rounded-md p-4 mb-5">
        <!-- Grade Average Section -->
        <div class="block" id="grade-average-results">
            <h2>Grade Average Analysis</h2>
            <div id="grade-average-table">
                <!-- Grade Average 테이블이 여기에 삽입됩니다 -->
            </div>
            <div id="top-grade-products">
                <h3>Top 5 Products by Grades</h3>
                <ul id="top-grade-products-list">
                    <!-- 상위 5개 상품명이 여기에 삽입됩니다 -->
                </ul>
            </div>
        </div>
    </section>
    <section class="card bg-white shadow-md rounded-md p-4 mb-5">
        <!-- Views, Age Group, and Gender Distribution Section -->
        <div class="block" id="views-and-demographics-results">
            <h2>Views and Demographics Analysis</h2>
            <div id="views-average-table">
                <!-- Views Average 테이블이 여기에 삽입됩니다 -->
            </div>
            <div id="top-views-products">
                <h3>Top 5 Products by Views</h3>
                <ul id="top-views-products-list">
                    <!-- 상위 5개 상품명이 여기에 삽입됩니다 -->
                </ul>
            </div>
            <div id="age-group-table">
                <!-- Age Group 테이블이 여기에 삽입됩니다 -->
            </div>
            <div id="gender-distribution-table">
                <!-- Gender Distribution 테이블이 여기에 삽입됩니다 -->
            </div>
        </div>
    </section>
    <section class="card bg-white shadow-md rounded-md p-4 mb-5">
        <!-- Purchases Section -->
        <div class="block" id="purchases-results">
            <h2>Purchases Analysis</h2>
            <div id="purchases-average-table">
                <!-- Purchases Average 테이블이 여기에 삽입됩니다 -->
            </div>
            <div id="top-purchases-products">
                <h3>Top 5 Products by Purchases</h3>
                <ul id="top-purchases-products-list">
                    <!-- 상위 5개 상품명이 여기에 삽입됩니다 -->
                </ul>
            </div>
            <div id="age-group-purchases-table">
                <!-- Age Group Purchases 테이블이 여기에 삽입됩니다 -->
            </div>
            <div id="gender-distribution-purchases-table">
                <!-- Gender Distribution Purchases 테이블이 여기에 삽입됩니다 -->
            </div>
        </div>
    </section>
    <section class="card bg-white shadow-md rounded-md p-4 mb-5">
        <!-- Purchase Reviews by Category Section -->
        <div class="block" id="purchase-reviews-by-category">
            <h2>Purchase Reviews by Category</h2>
            <div class="purchase-reviews-container">
                <div id="review-tag-results">
                    <!-- Review Tag 분석 결과가 여기에 삽입됩니다 -->
                </div>
                <div class="review-tag-buttons">
                    <button class="review-tag-button" onclick="fetchPurchaseReviews('size')">Size</button>
                    <button class="review-tag-button" onclick="fetchPurchaseReviews('brightness')">Brightness</button>
                    <button class="review-tag-button" onclick="fetchPurchaseReviews('color')">Color</button>
                    <button class="review-tag-button" onclick="fetchPurchaseReviews('thickness')">Thickness</button>
                    <button class="review-tag-button" onclick="fetchPurchaseReviews('warmth')">Warmth</button>
                    <button class="review-tag-button" onclick="fetchPurchaseReviews('weight')">Weight</button>
                    <button class="review-tag-button" onclick="fetchPurchaseReviews('delivery')">Delivery</button>
                    <button class="review-tag-button" onclick="fetchPurchaseReviews('packaging')">Packaging</button>
                </div>
            </div>
        </div>
    </section>
<script>
    const subcategories = {
        "상의": ["민소매/반소매/카라 티셔츠", "맨투맨/니트/스웨트", "긴소매 티셔츠", "셔츠/블라우스"],
        "바지": ["데님 팬츠", "숏 팬츠", "슈트 팬츠/슬랙스", "기타 바지"],
        "아우터": ["나일론/코치", "아노락 재킷", "후드 집업", "겨울 코트", "슈트/ 블레이저 재킷", 
                   "숏패딩/헤비 아우터", "플리스/뽀글이/기타 아우터", "블루종/트러커 재킷", "베스트/카디건"]
    };

    const reviewTagLabels = {
        size: { positive: '사이즈가 커요', negative: '사이즈가 작아요' },
        brightness: { positive: '밝기 밝아요', negative: '밝기 어두워요' },
        color: { positive: '색감 선명해요', negative: '색감 흐려요' },
        thickness: { positive: '두께감 두꺼워요', negative: '두께감 얇아요' },
        warmth: { positive: '보온성 따뜻해요', negative: '보온성 약해요' },
        weight: { positive: '무게감 무거워요', negative: '무게감 가벼워요' },
        delivery: { positive: '배송 빨라요', negative: '배송 느려요' },
        packaging: { positive: '포장 꼼꼼해요', negative: '포장 아쉬워요' }
    };

    function updateSubcategories() {
        const category = document.getElementById('category').value;
        const subcategoryContainer = document.getElementById('subcategory-container');
        
        // Clear previous subcategory checkboxes
        subcategoryContainer.innerHTML = '';

        if (category && subcategories[category]) {
            subcategories[category].forEach(subcategory => {
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.name = 'subcategory';
                checkbox.value = subcategory;
                checkbox.id = subcategory;

                const label = document.createElement('label');
                label.htmlFor = subcategory;
                label.textContent = subcategory;

                subcategoryContainer.appendChild(checkbox);
                subcategoryContainer.appendChild(label);
            });
        }
    }

    function applyFilters() {
        const category = document.getElementById('category').value;
        const selectedSubcategories = Array.from(document.querySelectorAll('input[name="subcategory"]:checked')).map(cb => cb.value);

        const data = { category, subcategory: selectedSubcategories };

        fetchProductLikes(data);
        fetchGradeAverages(data);
        fetchViewsAverage(data);
        fetchPurchasesData(data);
    }

    function fetchProductLikes(data) {
        fetch('/product_performance_analysis/product-performance-analysis/likes/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => renderProductLikeResults(data))
        .catch(error => console.error('Error:', error));
    }

    function fetchGradeAverages(data) {
        fetch('/product_performance_analysis/product-performance-analysis/grades/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => renderGradeAverageResults(data))
        .catch(error => console.error('Error:', error));
    }

    function fetchViewsAverage(data) {
        fetch('/product_performance_analysis/product-performance-analysis/views/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => renderViewsAndDemographicsResults(data))
        .catch(error => console.error('Error:', error));
    }

    function fetchPurchasesData(data) {
        fetch('/product_performance_analysis/product-performance-analysis/purchases/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => renderPurchasesResults(data))
        .catch(error => console.error('Error:', error));
    }

    function fetchPurchaseReviews(reviewTag) {
        const category = document.getElementById('category').value;

        if (!category) {
            alert('카테고리를 선택해주세요.');
            return;
        }

        fetch('/product_performance_analysis/product-performance-analysis/purchase-reviews/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ category: category, reviewtags: [reviewTag] })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            renderReviewTagResult(reviewTag, data[reviewTag]);
            updateActiveButton(reviewTag);
        })
        .catch(error => {
            console.error('Error:', error);
            alert('리뷰 데이터를 가져오는 중 오류가 발생했습니다.');
        });
    }

    function renderProductLikeResults(data) {
    const resultsDiv = document.getElementById('product-like-table');
    let html = '<table>';
    html += '<thead><tr><th>Category</th><th>Subcategory</th><th>Brand</th><th>Product Likes</th></tr></thead>';
    html += '<tbody>';
    
    data.forEach(item => {
        html += `<tr>
                    <td>${item.category}</td>
                    <td>${item.subcategory}</td>
                    <td>${item.brand}</td>
                    <td>${item.average_like !== undefined ? item.average_like : 'N/A'}</td>
                </tr>`;
        
        // 상위 5개 상품의 좋아요 수를 업데이트합니다.
        renderTopProducts(item.top_products, 'top-like-products-list');
    });

    html += '</tbody></table>';
    resultsDiv.innerHTML = html;
}

function renderTopProducts(topProducts, listId) {
    const listContainer = document.getElementById(listId);
    let html = '<ul>';
    
    // 상위 5개 상품의 정보 표시
    topProducts.slice(0, 5).forEach(product => {
        html += `<li>
                    <span>${product.name}</span> - <span>${product.likes !== undefined ? product.likes : 'N/A'}</span> likes
                </li>`;
    });
    
    html += '</ul>';
    listContainer.innerHTML = html;
}

    function renderGradeAverageResults(data) {
        const resultsDiv = document.getElementById('grade-average-table');
        let html = '<table>';
        html += '<thead><tr><th>Category</th><th>Subcategory</th><th>Brand</th><th>Average Grade</th></tr></thead>';
        html += '<tbody>';
        
        data.forEach(item => {
            html += `<tr>
                        <td>${item.category}</td>
                        <td>${item.subcategory}</td>
                        <td>${item.brand}</td>
                        <td>${item.average_grade.toFixed(2)}</td>
                    </tr>`;
            renderTopProducts(item.top_products, 'top-grade-products-list');
        });

        html += '</tbody></table>';
        resultsDiv.innerHTML = html;
    }

    function renderViewsAndDemographicsResults(data) {
        const viewsResultsDiv = document.getElementById('views-average-table');
        let viewsHtml = '<table>';
        viewsHtml += '<thead><tr><th>Category</th><th>Subcategory</th><th>Average Views</th></tr></thead>';
        viewsHtml += '<tbody>';
        viewsHtml += `<tr>
                        <td>${data.category}</td>
                        <td>${data.subcategories}</td>
                        <td>${data.average_views}</td>
                      </tr>`;
        viewsHtml += '</tbody></table>';
        viewsResultsDiv.innerHTML = viewsHtml;

        renderTopProducts(data.top_products, 'top-views-products-list');

        const ageGroupResultsDiv = document.getElementById('age-group-table');
        let ageGroupHtml = '<table>';
        ageGroupHtml += '<thead><tr><th>Age Group</th><th>Views</th></tr></thead>';
        ageGroupHtml += '<tbody>';
        for (const [ageGroup, views] of Object.entries(data.age_groups)) {
            ageGroupHtml += `<tr>
                                <td>${ageGroup.replace('views_', '')}</td>
                                <td>${views}</td>
                            </tr>`;
        }
        ageGroupHtml += '</tbody></table>';
        ageGroupResultsDiv.innerHTML = ageGroupHtml;
        const genderResultsDiv = document.getElementById('gender-distribution-table');
        let genderHtml = '<table>';
        genderHtml += '<thead><tr><th>Gender</th><th>Views</th><th>Ratio (%)</th></tr></thead>';
        genderHtml += '<tbody>';
        genderHtml += `<tr>
                        <td>Male</td>
                        <td>${data.gender_views.views_male}</td>
                        <td>${data.gender_views.male_ratio}</td>
                      </tr>`;
        genderHtml += `<tr>
                        <td>Female</td>
                        <td>${data.gender_views.views_female}</td>
                        <td>${data.gender_views.female_ratio}</td>
                      </tr>`;
        genderHtml += '</tbody></table>';
        genderResultsDiv.innerHTML = genderHtml;
    }

    function renderPurchasesResults(data) {
        const purchasesResultsDiv = document.getElementById('purchases-average-table');
        let purchasesHtml = '<table>';
        purchasesHtml += '<thead><tr><th>Category</th><th>Subcategory</th><th>Average Purchases</th></tr></thead>';
        purchasesHtml += '<tbody>';
        purchasesHtml += `<tr>
                            <td>${data.category}</td>
                            <td>${data.subcategories}</td>
                            <td>${data.average_purchases}</td>
                          </tr>`;
        purchasesHtml += '</tbody></table>';
        purchasesResultsDiv.innerHTML = purchasesHtml;

        renderTopProducts(data.top_products, 'top-purchases-products-list');

        const ageGroupPurchasesResultsDiv = document.getElementById('age-group-purchases-table');
        let ageGroupPurchasesHtml = '<table>';
        ageGroupPurchasesHtml += '<thead><tr><th>Age Group</th><th>Purchases</th></tr></thead>';
        ageGroupPurchasesHtml += '<tbody>';
        for (const [ageGroup, purchases] of Object.entries(data.age_groups)) {
            ageGroupPurchasesHtml += `<tr>
                                        <td>${ageGroup.replace('purchases_', '')}</td>
                                        <td>${purchases}</td>
                                      </tr>`;
        }
        ageGroupPurchasesHtml += '</tbody></table>';
        ageGroupPurchasesResultsDiv.innerHTML = ageGroupPurchasesHtml;

        const genderPurchasesResultsDiv = document.getElementById('gender-distribution-purchases-table');
        let genderPurchasesHtml = '<table>';
        genderPurchasesHtml += '<thead><tr><th>Gender</th><th>Purchases</th><th>Ratio (%)</th></tr></thead>';
        genderPurchasesHtml += '<tbody>';
        genderPurchasesHtml += `<tr>
                                  <td>Male</td>
                                  <td>${data.gender_purchases.purchases_male}</td>
                                  <td>${data.gender_purchases.male_ratio}</td>
                                </tr>`;
        genderPurchasesHtml += `<tr>
                                  <td>Female</td>
                                  <td>${data.gender_purchases.purchases_female}</td>
                                  <td>${data.gender_purchases.female_ratio}</td>
                                </tr>`;
        genderPurchasesHtml += '</tbody></table>';
        genderPurchasesResultsDiv.innerHTML = genderPurchasesHtml;
    }

    function renderReviewTagResult(tag, score) {
    const resultsDiv = document.getElementById('review-tag-results');
    const visualClass = score > 0 ? 'positive' : (score < 0 ? 'negative' : '');
    const sliderPosition = ((score + 1) / 2) * 100;
    const labels = reviewTagLabels[tag];

    resultsDiv.innerHTML = `
        <div class="reviewtag-result">
            <div class="reviewtag-title">${tag.charAt(0).toUpperCase() + tag.slice(1)}</div>
            <div class="slider-container">
                <div class="slider-labels">
                    <span>${labels.negative}</span>
                    <span>보통</span>
                    <span>${labels.positive}</span>
                </div>
                <div class="slider-track">
                    <div class="slider-fill" style="width: ${sliderPosition}%;"></div>
                    <div class="slider-thumb ${visualClass}" style="left: ${sliderPosition}%;"></div>
                </div>
            </div>
        </div>`;

    // 슬라이더 썸 위치 조정을 위한 setTimeout
    setTimeout(() => {
        const thumb = document.querySelector('.slider-thumb');
        const track = document.querySelector('.slider-track');
        const thumbRect = thumb.getBoundingClientRect();
        const trackRect = track.getBoundingClientRect();
        
        // 썸이 트랙의 끝에 걸치지 않도록 위치 조정
        const maxLeft = trackRect.width - thumbRect.width / 2;
        const minLeft = thumbRect.width / 2;
        let newLeft = (sliderPosition / 100) * trackRect.width;
        newLeft = Math.max(minLeft, Math.min(newLeft, maxLeft));
        
        thumb.style.left = `${(newLeft / trackRect.width) * 100}%`;
    }, 0);
}

    function updateActiveButton(activeTag) {
        document.querySelectorAll('.review-tag-button').forEach(button => {
            if (button.textContent.toLowerCase() === activeTag) {
                button.classList.add('active');
            } else {
                button.classList.remove('active');
            }
        });
    }

    function renderTopProducts(products, elementId) {
        const listElement = document.getElementById(elementId);
        listElement.innerHTML = ''; // 기존 리스트를 비움

        products.forEach(product => {
            const listItem = document.createElement('li');
            listItem.textContent = product;
            listElement.appendChild(listItem);
        });
    }

</script>
</body>
</html>

{% endblock %}